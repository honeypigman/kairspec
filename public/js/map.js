$(document).ready(function(){$(".marker").parent("div").on("mouseover",function(){$(this).css("z-index","999")}),$(".marker").parent("div").on("mouseleave",function(){$(this).css("z-index","-1")}),$(".marker").hover(function(){eventMarkerInfo($(this))}),$(".marker").on("click",function(){eventMarkerInfo($(this))});let a=!1;$("#find-me").on("click",function(){a=!0;$(this).append("<div class='spinner-border spinner-border-sm img-center' role='status'><span class='visually-hidden'>Loading...</span></div> "),$(this).css("background-image",'url("")'),findStation()})});var initPoint=new naver.maps.LatLng(37.572025,127.005028),mapDiv=document.getElementById("map"),map=new naver.maps.Map(mapDiv,{center:initPoint,zoom:5});function eventMarkerInfo(a){var t=$(a).find("span.date").data("date"),e=$(a).data("grade"),n=$(a).find("span.msg").data("msg"),s=$(a).find("span.pm10").data("pm10"),i=$(a).find("span.pm25").data("pm25"),r=$(a).find("span.city").data("city"),o=$(a).find("span.station").data("station");$(a).find("span.marker-bg").addClass("bg_"+e),$("#markerDetail").removeClass(),$("#markerDetail").addClass("alert alert-success d-block"),$("#markerDetail").addClass("bg_"+e),$("#msg").empty().text(n),$("#pm10").empty().text(s),$("#pm25").empty().text(i),$("#city").empty().text(r),$("#stationName").empty().text(o),$("#emoticonDetail").attr("src","/img/"+e+".png"),setChartStationTimeFlow(t,r,o)}function addMarker(a,t,e,n,s,i=0,r=0,o,m){var d="grade"+a,p=new naver.maps.LatLng(n,s),c={position:p,icon:{content:'<span class="marker '+d+'" data-grade="'+d+'"><span class="emoticon"></span><span class="pm10" data-pm10="'+i+'"></span><span class="pm25" data-pm25="'+r+'"></span><span class="station" data-station="'+m+'"></span><span class="city" data-city="'+o+'"></span><span class="msg" data-msg="'+t+'"></span><span class="date" data-date="'+e+'"></span><span class="marker-bg"></sapn></span>',size:new naver.maps.Size(27,34),origin:new naver.maps.Point(0,0),anchor:new naver.maps.Point(11,34)}},l=new naver.maps.Marker(c);l.setMap(map),naver.maps.Event.addListener(l,"click",function(){zoomIn(p)})}function zoomIn(a){var t;t=13-map.getZoom(),map.zoomBy(t,a,!0)}function setChartStationTimeFlow(a,t,e){let n=[],s=[],i=[],r=a.substring(0,10);$.ajax({method:"GET",url:"/api/find/station/timeflow/"+r+"/"+t+"/"+e,dataType:"JSON",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(t){JSON.stringify(t);$.each(t,function(){n.push(this.time.substring(.2)),s.push(this.data.pm10),i.push(this.data.pm25)});var e={labels:n,datasets:[{label:"미세먼지",borderColor:"rgba(255, 206, 86)",backgroundColor:"rgba(255, 206, 86)",fill:!1,data:s,yAxisID:"y-axis-1"},{label:"초미세먼지",borderColor:"rgba(255, 99, 132)",backgroundColor:"rgba(255, 99, 132)",fill:!1,data:i,yAxisID:"y-axis-2"}]},r=document.getElementById("myChart").getContext("2d");new Chart(r,{type:"line",data:e,options:{responsive:!0,hoverMode:"index",stacked:!1,title:{display:!0,text:a},scales:{yAxes:[{type:"linear",display:!0,position:"left",id:"y-axis-1"},{type:"linear",display:!0,position:"right",id:"y-axis-2",gridLines:{drawOnChartArea:!1}}]}}})},error:function(a){console.log("Error>"+a)}})}function findStation(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(a){const t=a.coords.latitude,e=a.coords.longitude;$("#find-me").text(""),$("#find-me").css("background-image",'url("/img/point.png")'),$.ajax({method:"GET",url:"/api/find/station/"+t+"/"+e,dataType:"JSON",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(a){var t=a.mesure_date,e=a.grade,n=a.msg,s=a.city,i=a.stationName,r=a.mesure_pm10,o=a.mesure_pm25;$("#markerDetail").removeClass(),$("#markerDetail").addClass("alert alert-success d-block"),$("#markerDetail").addClass("bg_grade"+e),$("#msg").empty().text(n),$("#pm10").empty().text(r),$("#pm25").empty().text(o),$("#city").empty().text(s),$("#stationName").empty().text(i),$("#emoticonDetail").attr("src","/img/grade"+e+".png"),setChartStationTimeFlow(t,s,i),zoomIn(new naver.maps.LatLng(a.dmX,a.dmY)),click=!0},error:function(a){console.log("Error>"+a),click=!1}})},function(){alert("ERR>Unable to retrieve your location."),click=!1})}
